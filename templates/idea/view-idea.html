{% extends "../layouts/main_layout.html" %}
{% load staticfiles %}

{% block stylesheet %}
<!-- Website Font style -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">

<link rel="stylesheet" href="{% static 'css/auth/auth.css' %}">
    <!-- Loading one more time..... -->
    <link rel="stylesheet" href="{% static 'libs/bootstrap/bootstrap.4.1.min.css' %}">
{% endblock %}

{% block headerextra %}
{% endblock %}

{% block content %}

    <div class="container">
    <div class="row">
      <div class="col-sm-9 col-md-7 col-lg-5 mx-auto">
        <div class="card card-signin my-5 idea-info" value="{{ idea.id }}">
          <div class="card-body">
              <div class="card-title text-center" style="font-weight: normal; margin-bottom: 10px;">{{ idea.title }}</div>
              <div style="margin-bottom: 14px;">{{ idea.idea }}</div>
              <table>
                  <tr>
                  <td style="padding-right: 152px; color: darkblue;">Active:</td>
                    <td>{{ idea.is_active }}</td>
              </tr>
              <tr>
                <td style="color: darkblue;">Date created:</td>
                <td>{{ idea.meta_created_at }}</td>
              </tr>
              <tr>
                <td style="color: darkblue;">Last updated:</td>
                <td>{{ idea.meta_last_updated_at }}</td>
              </tr>
            </table>
              {% if ownsIdea %}
              <div style="margin-top: 15px;">
                {% if campaignId == -1 %}
                  <a class="btn btn-light btn-primary btn-block"
                    href="{% url 'campaignApp:postCampaign' %}?idea={{ idea.id }}">
                    Kickstart Campaign
                  </a>
                {% else %}
                  <a class="btn btn-light btn-primary btn-block"
                    href="{% url 'campaignApp:getCampaignById' campaignId %}">
                    View Campaign
                  </a>
                {% endif %}
              </div>
              {% endif %}
          </div>
          <div class="card-footer text-muted rating-info" value="100">
              <div class="row">
                  <div class="col">
                      Rating: <span class="rating" value="10">{{idea.rating}}</span>
                  </div>
                  <div class="col">                                   
                      <div class="text-right rank-btns" value="10">
                          <a class="rank down-rank" style="color: gray" href ="#">
                              <span class="rank-val", value="-1" hidden></span>
                              <span class="fa fa-thumbs-o-down px-1"  aria-hidden="true"></span>
                          </a> 
                          <a class="rank up-rank" style="color: gray" href="#">
                              <span class="rank-val", value="1" hidden></span>
                              <span class="fa fa-thumbs-o-up px-1"  aria-hidden="true"></span>
                          </a>

                      </div>
                  </div>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>


{% endblock %}

{% block js %}
<script type="text/javascript">
    function update_rank_buttons(btns_elem, rank){
        var up_btn = $(btns_elem).find(".up-rank")
        var down_btn = $(btns_elem).find(".down-rank")

        if (rank == -1) {
            up_btn.css("color", "gray")
            down_btn.css("color", "red")
        }
        else if (rank == 1) {
            up_btn.css("color", "green")
            down_btn.css("color", "gray")
        }
        else {
            up_btn.css("color", "gray")
            down_btn.css("color", "gray")
        }
    }

    $(document).ready(function() {
        $.get(
            "{% url 'ideaApp:getIdeaRankForUser' idea.id %}", 
            function(data){
                update_rank_buttons($(".rank-btns"), data.rank)
            }
        );
        $(".rank").click(function(event){
            event.preventDefault();
            var value = $(this).find(".rank-val").attr('value');
            var rating_span = $(this).parents(".rating-info").find(".rating");
            var id = {{ idea.id }};
            $.post(
                "{% url 'ideaApp:postRankIdea' %}", 
                {rank: value, idea_id: id },
                function(data){
                    rating_span.text(data.rating);
                    update_rank_buttons($(".rank-btns"), data.rank);
                }
            );
        });
    });
</script>
{% endblock %}